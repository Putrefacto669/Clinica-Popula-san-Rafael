<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Clinica Popular San Rafael - Sistema de Correos</title>
<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
<style>
    :root {
        --primary-color: #2a9d8f; /* verde calmante */
        --secondary-color: #264653; /* azul profundo */
        --accent-color: #8ab17d; /* verde suave para detalles */
        --text-color: #333;
        --bg-light: #f0f4f8;
        --bg-form: #e0f2f1;
        --success-color: #27ae60;
        --error-color: #e74c3c;
    }

    * { margin:0; padding:0; box-sizing:border-box; font-family: 'Roboto', sans-serif; }
    body {
        min-height:100vh;
        display:flex;
        justify-content:center;
        align-items:center;
        background: linear-gradient(135deg, #a8dadc 0%, #457b9d 100%);
        padding:20px;
    }

    .container {
        width:95%;
        max-width:1200px;
        background:white;
        border-radius:20px;
        box-shadow:0 15px 40px rgba(0,0,0,0.2);
        overflow:hidden;
        display:flex;
        min-height:650px;
    }

    /* Secci√≥n del Mapa */
    .map-section {
        flex:1;
        background: var(--bg-light);
        display:flex;
        flex-direction:column;
        min-width:0;
    }

    .map-header {
        padding:25px;
        background:white;
        border-bottom:1px solid #d0d7de;
    }

    .university-name {
        color: var(--secondary-color);
        font-size:1.8rem;
        font-weight:700;
        margin-bottom:8px;
    }

    .university-address {
        color:#666;
        font-size:1rem;
        margin-bottom:15px;
    }

    .rating-container {
        display:flex;
        justify-content:space-between;
        align-items:center;
        margin-bottom:20px;
    }

    .rating { display:flex; align-items:center; gap:10px; }
    .stars { color:#ffb400; font-size:1.2rem; }
    .reviews { color:#666; font-weight:500; }

    .directions-btn {
        background: var(--primary-color);
        color:white;
        border:none;
        padding:12px 25px;
        border-radius:25px;
        cursor:pointer;
        font-weight:600;
        transition: all 0.3s ease;
    }

    .directions-btn:hover {
        background:#21867a;
        transform:translateY(-2px);
        box-shadow:0 5px 15px rgba(42,157,143,0.3);
    }

    .contact-info {
        background: var(--bg-light);
        padding:20px;
        border-radius:10px;
        margin-top:10px;
    }

    .contact-info p {
        margin-bottom:8px;
        color: var(--text-color);
        display:flex;
        align-items:center;
        gap:10px;
    }

    .contact-info i { color: var(--primary-color); font-weight:bold; }

    .map-container { flex:1; background:#e9ecef; position:relative; min-height:300px; }

    /* Secci√≥n del Formulario */
    .form-section {
        flex:1;
        background: var(--bg-form);
        padding:40px;
        display:flex;
        flex-direction:column;
        justify-content:center;
        min-width:0;
    }

    .form-title {
        color: var(--secondary-color);
        font-size:2.2rem;
        font-weight:700;
        margin-bottom:10px;
        text-align:center;
    }

    .patient-card {
        background: rgba(42,157,143,0.1);
        padding:20px;
        border-radius:12px;
        margin:25px 0;
        border-left:4px solid var(--primary-color);
    }

    .patient-card h3 { 
        color: var(--secondary-color); 
        font-size:1.1rem; 
        font-weight:600; 
        margin-bottom:12px; 
        display: flex;
        align-items: center;
        gap: 10px;
    }

    .patient-info {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 10px;
        margin-top: 10px;
    }

    .info-item {
        display: flex;
        flex-direction: column;
    }

    .info-label {
        font-size: 0.8rem;
        color: #666;
        margin-bottom: 4px;
    }

    .info-value {
        font-weight: 600;
        color: var(--secondary-color);
    }

    .contact-form { display:flex; flex-direction:column; gap:18px; }

    .form-group { display:flex; flex-direction:column; }

    .form-label {
        font-weight: 600;
        margin-bottom: 8px;
        color: var(--secondary-color);
        display: flex;
        align-items: center;
        gap: 8px;
    }

    .form-input, .form-textarea, .form-select {
        padding:15px 20px;
        border:2px solid rgba(42,157,143,0.3);
        border-radius:12px;
        background:white;
        color: var(--secondary-color);
        font-size:1rem;
        transition: all 0.3s ease;
    }

    .form-input:focus, .form-textarea:focus, .form-select:focus {
        outline:none;
        border-color: var(--primary-color);
        box-shadow:0 0 0 3px rgba(42,157,143,0.2);
        transform: translateY(-2px);
    }

    .form-input::placeholder, .form-textarea::placeholder { color:#999; }
    .form-textarea { resize:vertical; min-height:120px; }
    .form-select { cursor: pointer; }

    .template-buttons {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 10px;
        margin-bottom: 10px;
    }

    .template-btn {
        padding: 12px;
        border: 2px solid var(--primary-color);
        background: transparent;
        color: var(--primary-color);
        border-radius: 8px;
        cursor: pointer;
        font-weight: 600;
        transition: all 0.3s ease;
        text-align: center;
    }

    .template-btn:hover {
        background: var(--primary-color);
        color: white;
        transform: translateY(-2px);
    }

    /* Frutiger Aero Button */
    .frutiger-aero-button {
        --hue: 180;
        --sat: 0.25;
        --glow-intensity: 0.75;
        --fg: oklch(15% calc(var(--sat)*0.5) var(--hue));
        --bg: oklch(75% var(--sat) var(--hue)/0.8);
        --bg-dark: oklch(45% var(--sat) var(--hue)/0.75);
        --bottom-glow: radial-gradient(farthest-corner at bottom center, rgba(255,255,255,var(--glow-intensity)), transparent);
        background-color: var(--bg);
        background: var(--bottom-glow), linear-gradient(to bottom, var(--bg-dark), var(--bg));
        border:1px solid var(--bg);
        border-radius:9999px;
        box-shadow:0 4px 4px rgba(0,0,0,0.4);
        color: var(--fg);
        font-family: "Roboto", sans-serif;
        font-weight:700;
        text-shadow:0 2px 0.5em rgba(0,0,0,0.2);
        cursor:pointer;
        position:relative;
        transition: all 300ms ease;
        user-select:none;
        -webkit-user-select:none;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 10px;
    }

    .frutiger-aero-button::after {
        content:"";
        position:absolute;
        top:4%;
        left:0.75em;
        width:calc(100% - 1.5em);
        height:40%;
        background:linear-gradient(to bottom, rgba(255,255,255,0.8), rgba(255,255,255,0.1));
        border-radius:inherit;
        transition: background 400ms ease;
        pointer-events:none;
    }

    .frutiger-aero-button:hover, .frutiger-aero-button:focus {
        box-shadow:0 6px 8px rgba(0,0,0,0.4);
        transform:translateY(-2px);
    }

    .frutiger-aero-button:active {
        box-shadow:0 2px 4px rgba(0,0,0,0.4);
        transform:translateY(1px);
    }

    .frutiger-aero-button.large { padding:1em 3em; font-size:1.125rem; }

    .status-message {
        padding: 15px;
        border-radius: 10px;
        margin-top: 15px;
        text-align: center;
        font-weight: 600;
        display: none;
    }

    .status-success {
        background: #d4edda;
        color: #155724;
        border: 1px solid #c3e6cb;
    }

    .status-error {
        background: #f8d7da;
        color: #721c24;
        border: 1px solid #f5c6cb;
    }

    /* Responsive */
    @media (max-width:968px) {
        .container { flex-direction:column; width:100%; }
        .map-section, .form-section { width:100%; }
        .form-section { padding:30px 25px; }
        .map-header { padding:20px; }
        .patient-info { grid-template-columns: 1fr; }
        .template-buttons { grid-template-columns: 1fr; }
    }

    @media (max-width:480px) {
        body { padding:10px; }
        .container { border-radius:15px; }
        .university-name { font-size:1.5rem; }
        .form-title { font-size:1.8rem; }
        .form-section { padding:25px 20px; }
    }
</style>
</head>
<body>
    <div class="container">
        <!-- Secci√≥n del Mapa -->
        <section class="map-section">
            <div class="map-header">
                <h1 class="university-name">Cl√≠nica Popular San Rafael</h1>
                <p class="university-address">18 Calle Suroeste, Managua 12066</p>
                <div class="rating-container">
                    <div class="rating">
                        <span class="stars">‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</span>
                        <span class="reviews">4.9 (135 rese√±as)</span>
                    </div>
                    <button class="directions-btn">C√≥mo llegar</button>
                </div>
                <div class="contact-info">
                    <p><i>üè•</i> <strong>Masaya, Nicaragua</strong></p>
                    <p><i>üìû</i> +505 2278-9000</p>
                    <p><i>‚úâÔ∏è</i> contacto@clinicasanrafael.com</p>
                </div>
            </div>
            <div class="map-container">
                <iframe 
                    src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d259393.170369123!2d-86.56496736718749!3d12.136139000000021!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x8f7155d9ab28433b%3A0x328c37b99b12b841!2sUniversidad%20American%20College!5e1!3m2!1ses!2sni!4v1762397277923!5m2!1ses!2sni"
                    style="border:0; width:100%; height:100%;"
                    allowfullscreen="" loading="lazy" referrerpolicy="no-referrer-when-downgrade">
                </iframe>
            </div>
        </section>

        <!-- Secci√≥n del Formulario M√©dico -->
        <section class="form-section">
            <h2 class="form-title">üìß Comunicaci√≥n con Pacientes</h2>
            
            <div class="patient-card">
                <h3>üë§ Informaci√≥n del Paciente</h3>
                <div class="patient-info">
                    <div class="info-item">
                        <span class="info-label">Paciente Seleccionado:</span>
                        <span class="info-value" id="current-patient">No seleccionado</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">√öltima Cita:</span>
                        <span class="info-value" id="last-appointment">No disponible</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">M√©dico Tratante:</span>
                        <span class="info-value" id="treating-doctor">No asignado</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">Estado:</span>
                        <span class="info-value" id="patient-status">Sin informaci√≥n</span>
                    </div>
                </div>
            </div>

            <form class="contact-form" id="emailForm">
                <div class="form-group">
                    <label class="form-label">üë§ Nombre del Paciente</label>
                    <input type="text" class="form-input" id="patientName" placeholder="Ingrese el nombre completo del paciente" required>
                </div>
                
                <div class="form-group">
                    <label class="form-label">üìß Email del Paciente</label>
                    <input type="email" class="form-input" id="patientEmail" placeholder="paciente@ejemplo.com" required>
                </div>
                
                <div class="form-group">
                    <label class="form-label">üìû Tel√©fono de Contacto</label>
                    <input type="tel" class="form-input" id="patientPhone" placeholder="+505 1234-5678">
                </div>
                
                <div class="form-group">
                    <label class="form-label">üéØ Tipo de Comunicaci√≥n</label>
                    <select class="form-select" id="emailType">
                        <option value="appointment">Recordatorio de Cita</option>
                        <option value="results">Resultados de Ex√°menes</option>
                        <option value="followup">Seguimiento M√©dico</option>
                        <option value="general">Comunicaci√≥n General</option>
                        <option value="emergency">Comunicaci√≥n Urgente</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label class="form-label">üìù Plantillas R√°pidas</label>
                    <div class="template-buttons">
                        <button type="button" class="template-btn" onclick="cargarPlantilla('recordatorio')">Recordatorio de Cita</button>
                        <button type="button" class="template-btn" onclick="cargarPlantilla('resultados')">Resultados Listos</button>
                        <button type="button" class="template-btn" onclick="cargarPlantilla('seguimiento')">Seguimiento M√©dico</button>
                        <button type="button" class="template-btn" onclick="cargarPlantilla('urgente')">Comunicaci√≥n Urgente</button>
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="form-label">‚úèÔ∏è Asunto del Correo</label>
                    <input type="text" class="form-input" id="emailSubject" placeholder="Asunto del mensaje m√©dico" required>
                </div>
                
                <div class="form-group">
                    <label class="form-label">üìÑ Mensaje M√©dico</label>
                    <textarea class="form-textarea" id="emailMessage" placeholder="Escriba el mensaje m√©dico para el paciente..." required></textarea>
                </div>
                
                <div id="statusMessage" class="status-message"></div>
                
                <button type="submit" class="frutiger-aero-button large">
                    üì§ Enviar Correo M√©dico
                </button>
            </form>
        </section>
    </div>

    <script>
        // Plantillas predefinidas para correos m√©dicos
        const plantillas = {
            recordatorio: {
                asunto: "Recordatorio de Cita M√©dica - Cl√≠nica San Rafael",
                mensaje: `Estimado/a [Nombre],

Le recordamos su cita m√©dica programada para el [Fecha] a las [Hora] en nuestra cl√≠nica.

Por favor:
‚Ä¢ Llegue 15 minutos antes
‚Ä¢ Traiga su documento de identificaci√≥n
‚Ä¢ Traiga estudios m√©dicos previos si los tiene

Si necesita reprogramar, cont√°ctenos al +505 2278-9000.

Saludos cordiales,
Equipo M√©dico - Cl√≠nica San Rafael`
            },
            resultados: {
                asunto: "Resultados de Ex√°menes Disponibles - Cl√≠nica San Rafael",
                mensaje: `Estimado/a [Nombre],

Tenemos los resultados de sus ex√°menes m√©dicos listos para ser revisados.

Puede:
‚Ä¢ Recogerlos en recepci√≥n
‚Ä¢ Solicitar cita para revisi√≥n con su m√©dico
‚Ä¢ Consultar por nuestro portal en l√≠nea

Para mayor informaci√≥n, cont√°ctenos.

Atentamente,
Laboratorio Cl√≠nico - Cl√≠nica San Rafael`
            },
            seguimiento: {
                asunto: "Seguimiento M√©dico - Cl√≠nica San Rafael",
                mensaje: `Estimado/a [Nombre],

Como parte de su seguimiento m√©dico, le solicitamos que:

1. Programe una cita de control
2. Realice los ex√°menes indicados
3. Siga las recomendaciones del tratamiento

Estamos para apoyarle en su proceso de salud.

Cordialmente,
Equipo de Seguimiento - Cl√≠nica San Rafael`
            },
            urgente: {
                asunto: "URGENTE: Comunicaci√≥n M√©dica Importante - Cl√≠nica San Rafael",
                mensaje: `Estimado/a [Nombre],

Tenemos informaci√≥n m√©dica importante que requiere su atenci√≥n inmediata.

Por favor cont√°ctenos lo antes posible al +505 2278-9000.

Esto es de car√°cter urgente.

Atentamente,
Departamento M√©dico - Cl√≠nica San Rafael`
            }
        };

        // Cargar datos de la cita seleccionada desde Python
        function cargarDatosCita() {
            const urlParams = new URLSearchParams(window.location.search);
            const paciente = urlParams.get('paciente');
            const doctor = urlParams.get('doctor');
            const fecha = urlParams.get('fecha');
            const estado = urlParams.get('estado');

            if (paciente) {
                document.getElementById('patientName').value = paciente;
                document.getElementById('current-patient').textContent = paciente;
                document.getElementById('treating-doctor').textContent = doctor || 'Dr. No asignado';
                document.getElementById('last-appointment').textContent = fecha || 'No disponible';
                document.getElementById('patient-status').textContent = estado || 'Pendiente';
                
                document.getElementById('emailSubject').value = `Comunicaci√≥n M√©dica - ${paciente}`;
                
                if (fecha) {
                    setTimeout(() => cargarPlantilla('recordatorio'), 500);
                }
            }
        }

        // Cargar plantilla seleccionada
        function cargarPlantilla(tipo) {
            const plantilla = plantillas[tipo];
            if (plantilla) {
                const nombrePaciente = document.getElementById('patientName').value || '[Nombre]';
                const mensajePersonalizado = plantilla.mensaje.replace(/\[Nombre\]/g, nombrePaciente);
                
                document.getElementById('emailSubject').value = plantilla.asunto;
                document.getElementById('emailMessage').value = mensajePersonalizado;
                
                mostrarEstado('‚úÖ Plantilla cargada correctamente', 'success');
            }
        }

        // Validar formato de email
        function validarEmail(email) {
            const regex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            return regex.test(email);
        }

        // Mostrar estado del env√≠o
        function mostrarEstado(mensaje, tipo) {
            const statusElement = document.getElementById('statusMessage');
            statusElement.textContent = mensaje;
            statusElement.className = `status-message status-${tipo}`;
            statusElement.style.display = 'block';
            
            setTimeout(() => {
                statusElement.style.display = 'none';
            }, 5000);
        }

        // Enviar correo m√©dico
        function enviarCorreo(event) {
            event.preventDefault();
            
            const nombre = document.getElementById('patientName').value;
            const email = document.getElementById('patientEmail').value;
            const telefono = document.getElementById('patientPhone').value;
            const asunto = document.getElementById('emailSubject').value;
            const mensaje = document.getElementById('emailMessage').value;
            const tipo = document.getElementById('emailType').value;
            
            // Validaciones completas
            if (!nombre || !email || !asunto || !mensaje) {
                mostrarEstado('‚ùå Complete todos los campos requeridos', 'error');
                return;
            }
            
            if (!validarEmail(email)) {
                mostrarEstado('‚ùå Ingrese un email v√°lido', 'error');
                return;
            }
            
            if (mensaje.length < 10) {
                mostrarEstado('‚ùå El mensaje debe tener al menos 10 caracteres', 'error');
                return;
            }
            
            // Mostrar confirmaci√≥n detallada
            const confirmar = confirm(`¬øCONFIRMAR ENV√çO DE CORREO M√âDICO?\n\nüë§ Paciente: ${nombre}\nüìß Email: ${email}\nüéØ Tipo: ${document.getElementById('emailType').options[document.getElementById('emailType').selectedIndex].text}\nüìû Tel√©fono: ${telefono || 'No proporcionado'}\n\n¬øProceder con el env√≠o?`);
            
            if (confirmar) {
                mostrarEstado('üîÑ Enviando correo m√©dico...', 'success');
                
                // Datos para enviar a Python
                const datosCorreo = {
                    paciente: nombre,
                    email: email,
                    telefono: telefono,
                    asunto: asunto,
                    mensaje: mensaje,
                    tipo: tipo,
                    timestamp: new Date().toISOString(),
                    usuario: 'admin'
                };
                
                console.log('üìß Datos del correo m√©dico listos para Python:', datosCorreo);
                
                // Simular proceso de env√≠o
                setTimeout(() => {
                    mostrarEstado('‚úÖ Correo m√©dico enviado exitosamente\nüìä Registro guardado en base de datos', 'success');
                    
                    // Limpiar solo el mensaje, mantener datos del paciente
                    document.getElementById('emailMessage').value = '';
                    document.getElementById('emailSubject').value = `Seguimiento - ${nombre}`;
                    
                }, 2000);
            }
        }

        // Inicializar la aplicaci√≥n
        document.addEventListener('DOMContentLoaded', function() {
            cargarDatosCita();
            
            // Efectos visuales para inputs
            document.querySelectorAll('.form-input, .form-textarea, .form-select').forEach(input => {
                input.addEventListener('focus', function() {
                    this.style.transform = 'translateY(-2px)';
                });
                
                input.addEventListener('blur', function() {
                    this.style.transform = 'translateY(0)';
                });
            });
            
            // Actualizar asunto cuando cambie el tipo de comunicaci√≥n
            document.getElementById('emailType').addEventListener('change', function() {
                const tipoTexto = this.options[this.selectedIndex].text;
                const paciente = document.getElementById('patientName').value;
                const asuntoBase = paciente ? `${tipoTexto} - ${paciente}` : tipoTexto;
                document.getElementById('emailSubject').value = asuntoBase;
            });
            
            // Auto-generar email sugerido
            document.getElementById('patientName').addEventListener('blur', function() {
                const nombre = this.value.trim();
                if (nombre && !document.getElementById('patientEmail').value) {
                    const emailSugerido = nombre.toLowerCase().replace(/\s+/g, '.') + '@ejemplo.com';
                    document.getElementById('patientEmail').placeholder = `Ej: ${emailSugerido}`;
                }
            });
            
            // Manejar env√≠o del formulario
            document.getElementById('emailForm').addEventListener('submit', enviarCorreo);
            
            // Bot√≥n de direcciones
            document.querySelector('.directions-btn').addEventListener('click', function() {
                alert('üìç Cl√≠nica Popular San Rafael\nüìû +505 2278-9000\nüè• Masaya, Nicaragua');
            });

            console.log('üè• Sistema de correos m√©dicos inicializado');
        });
    </script>
</body>
</html>